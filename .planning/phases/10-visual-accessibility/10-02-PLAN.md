---
phase: 10-visual-accessibility
plan: 02
type: execute
domain: go-wasm
---

<objective>
Add prefers-reduced-motion support and verify color contrast compliance.

Purpose: Respect user motion preferences for vestibular disorder accessibility (WCAG 2.3.3) and ensure text meets contrast requirements (WCAG 1.4.3).
Output: Motion-aware animation system, verified color contrast compliance.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-accessibility-audit/A11Y-AUDIT.md
@.planning/phases/10-visual-accessibility/10-01-SUMMARY.md

# Key files:
@components/animation.go
@components/theme.go

**Tech stack available:** CSS media queries via JS, Tailwind motion utilities
**Established patterns:** js.Global() for browser API access

**Issues being addressed:**
- P2: Animations lack prefers-reduced-motion support (2.3.3)
- Untested: Color contrast needs verification (1.4.3)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add prefers-reduced-motion detection utility</name>
  <files>components/animation.go</files>
  <action>
Add a utility function to detect user's motion preference:

```go
// PrefersReducedMotion returns true if user has enabled reduced motion preference
func PrefersReducedMotion() bool {
    window := js.Global()
    matchMedia := window.Call("matchMedia", "(prefers-reduced-motion: reduce)")
    return matchMedia.Get("matches").Bool()
}
```

Place this function near the top of animation.go after the type definitions.

This uses the standard `window.matchMedia()` API to check the CSS media query.
  </action>
  <verify>
Build succeeds: `cd example && make build`
Function compiles without errors
  </verify>
  <done>PrefersReducedMotion() function exists and returns boolean based on user preference</done>
</task>

<task type="auto">
  <name>Task 2: Update animation system to respect reduced motion</name>
  <files>components/animation.go</files>
  <action>
Update the Animate() function and animation helpers to respect reduced motion:

1. **In Animate() function** (around line 182):
   - Check PrefersReducedMotion() at the start
   - If true: Skip animation, immediately apply final state if FillMode is "forwards"
   - If true and OnComplete callback exists: Call it immediately
   - Return early without applying animation

2. **Update animationsCSS** (around line 49):
   Add reduced motion media query at the end:
   ```css
   @media (prefers-reduced-motion: reduce) {
     *, *::before, *::after {
       animation-duration: 0.01ms !important;
       animation-iteration-count: 1 !important;
       transition-duration: 0.01ms !important;
     }
   }
   ```
   This provides CSS-level fallback for any animations not going through Animate().

3. **Update transition utility classes** in animationsCSS:
   The existing `.transition-*` classes will be handled by the media query above.

The JS check in Animate() handles programmatic animations. The CSS fallback handles inline transitions.
  </action>
  <verify>
Build succeeds: `cd example && make build`
In browser DevTools: Enable "Reduce motion" in Rendering panel
Verify: Animations skip or complete instantly when reduced motion enabled
  </verify>
  <done>Animation system respects prefers-reduced-motion: animations skip when enabled, callbacks still fire</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Focus indicators on all interactive components (Plan 01) and motion-respecting animation system (this plan)</what-built>
  <how-to-verify>
**Color Contrast Audit (WCAG 1.4.3 - 4.5:1 for normal text, 3:1 for large text):**

1. Run: `cd example && make dev`
2. Open: http://localhost:8080

3. **Test with browser DevTools:**
   - Chrome: DevTools → More tools → CSS Overview → Capture overview → Colors section
   - Or use axe DevTools extension → Run scan → Check contrast issues

4. **Key areas to check:**
   - Text on colored backgrounds (buttons, badges, alerts)
   - Placeholder text in inputs
   - Disabled state text
   - Dark mode variants

5. **Verify focus indicators:**
   - Tab through the page
   - Confirm all interactive elements show visible focus ring
   - Toggle dark mode and verify focus rings remain visible

6. **Verify reduced motion:**
   - DevTools → Rendering → Emulate CSS media feature → prefers-reduced-motion: reduce
   - Navigate the app - animations should be instant/skipped
   - Toast notifications should appear without slide animation
   - Modal/dialogs should appear without scale animation
  </how-to-verify>
  <resume-signal>Type "approved" if contrast and motion behavior are acceptable, or describe specific issues found</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd example && make build` succeeds
- [ ] PrefersReducedMotion() function exists
- [ ] Animate() checks motion preference before applying animation
- [ ] CSS includes @media (prefers-reduced-motion: reduce) block
- [ ] Human verified: Color contrast acceptable
- [ ] Human verified: Reduced motion respected
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No build errors
- WCAG 2.3.3 Animation from Interactions satisfied
- WCAG 1.4.3 Contrast verified (or issues documented for future fix)
- Phase 10 Visual Accessibility complete
</success_criteria>

<output>
After completion, create `.planning/phases/10-visual-accessibility/10-02-SUMMARY.md`

This completes Phase 10. Update STATE.md:
- Current Position: Phase 10 complete, ready for Phase 11
- Add key decisions about motion handling approach
</output>
