---
phase: 11-a11y-testing
plan: 01
type: execute
domain: accessibility
---

<objective>
Set up automated accessibility testing infrastructure using Playwright and axe-core to catch WCAG 2.1 AA regressions.

Purpose: Prevent accessibility regressions by integrating axe-core into the test pipeline, providing automated coverage for 30-50% of a11y issues and freeing human auditors for complex issues.
Output: Working Playwright + axe-core test suite with baseline test, WCAG 2.1 AA tagging, and Makefile integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-accessibility-audit/A11Y-AUDIT.md

# Key decisions from prior phases:
# - Phases 8-10 addressed 114 WCAG gaps documented in audit
# - WCAG 2.1 AA is the target compliance level
# - 25 components audited across 4 categories

# Current stack:
# - Go 1.24+ with WASM compilation
# - No test framework currently configured
# - Makefile-based build system in example/
# - Dev server on port 8093

@example/index.html
@example/Makefile
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up Playwright + axe-core test environment</name>
  <files>example/package.json, example/playwright.config.ts, example/tests/a11y.spec.ts, example/.gitignore</files>
  <action>
Create Node.js test environment in example/ directory:

1. Create package.json with:
   - @playwright/test as devDependency
   - @axe-core/playwright as devDependency
   - Scripts: "test" → "playwright test", "test:a11y" → "playwright test tests/a11y.spec.ts"

2. Create playwright.config.ts:
   - Use webServer to start `make dev` on port 8093
   - Set baseURL to http://localhost:8093
   - Configure timeout (30s for WASM load)
   - Single project targeting chromium (sufficient for a11y)
   - Output directory: test-results/

3. Create tests/a11y.spec.ts with:
   - Import AxeBuilder from @axe-core/playwright
   - Create test fixture that provides pre-configured AxeBuilder
   - Configure for WCAG 2.1 AA only: .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa'])
   - Basic structure for accessibility tests

4. Update .gitignore to exclude:
   - node_modules/
   - test-results/
   - playwright-report/
  </action>
  <verify>cd example && npm install && npx playwright install chromium</verify>
  <done>package.json exists with dependencies, playwright.config.ts configured, test file structure in place, chromium browser installed</done>
</task>

<task type="auto">
  <name>Task 2: Create baseline accessibility test</name>
  <files>example/tests/a11y.spec.ts</files>
  <action>
Implement comprehensive baseline accessibility test:

1. Create test "home page should have no WCAG 2.1 AA violations":
   - Navigate to base URL (waits for WASM to load)
   - Wait for #app to not contain "Loading..." (WASM mounted)
   - Run axe with WCAG 2.1 AA tags
   - Assert violations array is empty
   - On failure, log violation details (id, description, nodes affected)

2. Create helper function formatViolations(violations):
   - Returns readable string with: rule id, impact, description, affected elements
   - Makes test failures actionable

3. Add test "interactive components have no critical violations":
   - Target interactive component demo sections
   - Focus on high-impact rules: button-name, label, aria-required-attr
   - This catches the P0 critical issues from audit

4. Configure retries=1 in case of WASM loading flakiness

Best practices applied:
- Use toHaveLength(0) assertion for clear error messages
- Include violation summary in error message
- Tag tests appropriately for filtering
  </action>
  <verify>cd example && npm test -- --headed (runs test visibly to verify)</verify>
  <done>Tests execute against running app, pass if compliant, fail with actionable messages if violations found</done>
</task>

<task type="auto">
  <name>Task 3: Add Makefile test targets</name>
  <files>example/Makefile</files>
  <action>
Add test targets to existing Makefile:

1. Add test-setup target:
   - cd to example/ and run npm install
   - Run npx playwright install chromium
   - One-time setup for new developers

2. Add test target:
   - Build WASM first (dependency on build)
   - Run npm test
   - Fails build on a11y violations

3. Add test-a11y target (alias):
   - Same as test but more explicit
   - Useful for CI disambiguation

4. Add test-report target:
   - Runs npm test -- --reporter=html
   - Opens playwright-report/index.html
   - Useful for investigating failures

5. Update .PHONY declaration with new targets
  </action>
  <verify>cd example && make test-setup && make test</verify>
  <done>make test runs accessibility tests, CI-ready integration, fails on violations</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd example && npm install` succeeds
- [ ] `cd example && npx playwright test` runs and passes
- [ ] Test fails appropriately when a11y violation exists (verify by temporarily breaking)
- [ ] `make test` works from example/ directory
- [ ] Violation reports are readable and actionable
</verification>

<success_criteria>

- Playwright and axe-core installed and configured
- Baseline accessibility test covers home page with WCAG 2.1 AA rules
- Test failures include actionable violation details
- Makefile integration enables `make test` workflow
- Infrastructure ready for component-specific test additions
  </success_criteria>

<output>
After completion, create `.planning/phases/11-a11y-testing/11-01-SUMMARY.md`:

# Phase 11 Plan 01: axe-core Test Foundation Summary

**[Substantive description of what was built]**

## Accomplishments

- [What was created/implemented]

## Files Created/Modified

- `example/package.json` - Node.js test dependencies
- `example/playwright.config.ts` - Playwright configuration
- `example/tests/a11y.spec.ts` - Accessibility test suite
- `example/Makefile` - Test target additions

## Decisions Made

[Key decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[Ready for incremental test additions or v1.1 completion]
</output>
