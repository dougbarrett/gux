---
phase: 05-data-states
plan: 01
type: execute
---

<objective>
Create data export utilities for CSV and JSON formats with browser download support, and integrate export functionality into the Table component.

Purpose: Enable users to export table data in common formats for analysis, sharing, or backup.
Output: Export utility functions and Table component with export dropdown toolbar.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/03-table-enhancements/03-04-SUMMARY.md
@.planning/phases/04-ux-polish/04-03-SUMMARY.md

# Relevant source files:
@components/table.go
@components/dropdown.go

**Tech stack available:** Go WASM, syscall/js, encoding/csv, encoding/json
**Established patterns:** Props struct pattern, functional options, component Element() method
**Constraining decisions:**
- Table has SelectedRows() and allData for export data sources
- Use emoji icons for simplicity (from 01-01 decision)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create export utilities with download mechanism</name>
  <files>components/export.go</files>
  <action>
Create export.go with WASM build tag containing:

1. Download helper function:
   - func triggerDownload(data []byte, filename, mimeType string)
   - Create Blob via js.Global().Get("Blob")
   - Create object URL via URL.createObjectURL
   - Create anchor element, set href and download attributes
   - Programmatically click, then revoke URL

2. CSV export:
   - func ExportCSV(data []map[string]any, columns []string, filename string)
   - Build CSV string manually (Go's encoding/csv writes to io.Writer which is awkward in WASM)
   - Handle proper escaping (quotes, commas, newlines)
   - Use columns slice to determine order and headers
   - Call triggerDownload with "text/csv" mime type

3. JSON export:
   - func ExportJSON(data []map[string]any, filename string)
   - Use encoding/json.Marshal with indentation
   - Call triggerDownload with "application/json" mime type

Avoid using encoding/csv's Writer because it requires io.Writer which is cumbersome in WASM - manual string building is cleaner for this use case.
  </action>
  <verify>go build -o /dev/null ./components/ succeeds with GOOS=js GOARCH=wasm</verify>
  <done>ExportCSV and ExportJSON functions exist and compile, triggerDownload helper works</done>
</task>

<task type="auto">
  <name>Task 2: Add export dropdown to Table component</name>
  <files>components/table.go, example/app/main.go</files>
  <action>
1. Extend TableProps with export options:
   - Exportable bool - enables export dropdown
   - ExportFilename string - base filename (default "export")
   - ExportColumns []string - columns to export (nil = all)

2. Add export dropdown in Table:
   - Create dropdown button with "ðŸ“¥ Export" label
   - Position next to filter input (or in its own toolbar row if no filter)
   - Dropdown options: "CSV", "JSON" (PDF added in next plan)
   - On select, call appropriate export function with current data
   - Export should respect current filter (use filtered data, not allData)

3. Export behavior:
   - If Selectable and has selection: export selected rows only
   - Otherwise: export all filtered data
   - Use ExportFilename prop or default to "export"
   - Append format extension (.csv, .json)

4. Update example app:
   - Add Exportable: true to one of the table demos
   - Show export functionality in action

Follow existing Dropdown pattern from components/dropdown.go for the export menu.
  </action>
  <verify>GOOS=js GOARCH=wasm go build -o /dev/null ./... && cd example && make build</verify>
  <done>Table shows export dropdown, clicking CSV/JSON triggers file download with table data</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `GOOS=js GOARCH=wasm go build -o /dev/null ./...` succeeds
- [ ] `cd example && make build` succeeds
- [ ] Export dropdown appears on exportable tables
- [ ] CSV export produces valid CSV file
- [ ] JSON export produces valid JSON file
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript/Go errors introduced
- Export dropdown integrated with Table
- Downloads work in browser
</success_criteria>

<output>
After completion, create `.planning/phases/05-data-states/05-01-SUMMARY.md`
</output>
