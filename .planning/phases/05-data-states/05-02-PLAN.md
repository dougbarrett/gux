---
phase: 05-data-states
plan: 02
type: execute
---

<objective>
Add PDF export capability using jsPDF library, integrated with the Table export dropdown.

Purpose: Enable professional document export for printing, sharing, and archival purposes.
Output: PDF export function and "PDF" option in Table export dropdown.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/05-data-states/05-01-SUMMARY.md

# Relevant source files:
@components/export.go
@components/table.go
@example/index.html

**Tech stack available:** Go WASM, syscall/js, jsPDF (to be added)
**Established patterns:** Export utilities from 05-01, triggerDownload pattern
**Constraining decisions:**
- jsPDF loaded from CDN (no bundler in this project)
- Call jsPDF via js.Global().Get("jspdf")
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add jsPDF and create PDF export utility</name>
  <files>example/index.html, components/export.go</files>
  <action>
1. Add jsPDF to example/index.html:
   - Add script tag before wasm_exec.js:
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
   - Also add jspdf-autotable for table support:
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

2. Add PDF export to components/export.go:
   - type PDFExportOptions struct with Title, Orientation ("portrait"/"landscape"), PageSize ("a4"/"letter")
   - func ExportPDF(data []map[string]any, columns []TableColumn, filename string, options PDFExportOptions)
   - Get jsPDF constructor: js.Global().Get("jspdf").Get("jsPDF")
   - Create new jsPDF instance with orientation and page size
   - Add title if provided using doc.Call("text", title, x, y)
   - Use autoTable plugin: doc.Call("autoTable", tableOptions)
     - tableOptions is js.ValueOf(map[string]any{...}) with head, body, startY
     - head: column headers from columns
     - body: data rows with values in column order
   - Save PDF: doc.Call("save", filename)

3. Handle TableColumn type dependency:
   - If needed, accept columns as []string (header names) and []string (keys) separately
   - Or import TableColumn type (may need to restructure)
   - Simplest: func ExportPDF(data []map[string]any, headers []string, keys []string, filename string, options PDFExportOptions)

Avoid complex layouts - use autoTable's default styling which looks professional.
  </action>
  <verify>GOOS=js GOARCH=wasm go build -o /dev/null ./... succeeds</verify>
  <done>ExportPDF function exists, jsPDF scripts added to HTML</done>
</task>

<task type="auto">
  <name>Task 2: Add PDF option to Table export dropdown</name>
  <files>components/table.go</files>
  <action>
1. Extend export dropdown with PDF option:
   - Add "PDF" to the export format options
   - When PDF selected, call ExportPDF with:
     - Current filtered/selected data
     - Column headers from t.columns
     - Column keys from t.columns
     - Filename with .pdf extension
     - Default options (portrait, a4)

2. Handle column extraction:
   - Create helper to extract headers: []string from []TableColumn
   - Create helper to extract keys: []string from []TableColumn
   - Pass to ExportPDF

3. Consider export scope:
   - Same logic as CSV/JSON: selected rows if selection, else filtered data
  </action>
  <verify>cd example && make build succeeds</verify>
  <done>PDF option appears in export dropdown, clicking generates PDF file</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PDF export functionality with table formatting via jsPDF</what-built>
  <how-to-verify>
    1. Run: cd example && make dev
    2. Visit: http://localhost:8080
    3. Navigate to a table with Exportable: true
    4. Click Export dropdown, select "PDF"
    5. Confirm: PDF downloads with table data
    6. Open PDF and verify:
       - Table is formatted with headers
       - Data rows are readable
       - No layout issues or cut-off content
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `GOOS=js GOARCH=wasm go build -o /dev/null ./...` succeeds
- [ ] `cd example && make build` succeeds
- [ ] jsPDF scripts load without console errors
- [ ] PDF export generates valid PDF file
- [ ] Table data appears correctly formatted in PDF
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified PDF output quality
- PDF option available in export dropdown
- Generated PDFs are readable and well-formatted
</success_criteria>

<output>
After completion, create `.planning/phases/05-data-states/05-02-SUMMARY.md`
</output>
