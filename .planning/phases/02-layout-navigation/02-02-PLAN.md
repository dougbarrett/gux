---
phase: 02-layout-navigation
plan: 02
type: execute
---

<objective>
Create a Command Palette component with Cmd+K trigger for quick navigation and actions.

Purpose: Provide power users with keyboard-driven access to navigation and app commands without reaching for the mouse.
Output: CommandPalette component with search/filter, keyboard navigation, and global Cmd+K shortcut.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-layout-navigation/02-01-PLAN.md

# Key source files (patterns to follow):
@components/modal.go
@components/combobox.go
@components/focustrap.go
@example/app/main.go

**Tech stack available:** Go WASM, Tailwind CSS
**Established patterns:**
- Modal: overlay, backdrop click close, ESC close, body scroll lock
- Combobox: filtering, keyboard nav (ArrowUp/Down/Enter/ESC), highlight state
- FocusTrap: Tab key trapping within container
- Global keyboard listeners (Modal ESC pattern)

**From 02-01:**
- Sidebar now has collapse functionality
- Keyboard shortcut pattern established (RegisterKeyboardShortcut)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CommandPalette component</name>
  <files>components/command_palette.go</files>
  <action>
Create a new CommandPalette component combining Modal + Combobox patterns:

**Types:**
```go
type Command struct {
    ID          string
    Label       string      // Display text
    Description string      // Optional subtitle
    Icon        string      // Optional emoji/icon
    Category    string      // For grouping (e.g., "Navigation", "Actions")
    OnExecute   func()      // Action to run
    Shortcut    string      // Optional keyboard hint (e.g., "Ctrl+B")
}

type CommandPaletteProps struct {
    Commands     []Command
    Placeholder  string      // Search input placeholder
    EmptyMessage string      // "No commands found"
    OnClose      func()      // Called when palette closes
}
```

**Structure:**
1. Overlay: fixed inset-0, bg-black/50, z-50, flex items-start justify-center, pt-[20vh]
2. Palette container: bg-white dark:bg-gray-800, rounded-lg, shadow-2xl, max-w-lg w-full, mx-4
3. Search input: sticky top, border-b, px-4 py-3, autofocus
4. Results list: max-h-[60vh], overflow-y-auto
5. Footer: border-t, px-4 py-2, hints (arrows to navigate, enter to select, esc to close)

**State:**
- isOpen bool
- query string (search filter)
- filteredCommands []Command
- highlightIdx int (-1 = none)

**Methods:**
- Open() - show palette, focus input, reset state
- Close() - hide palette, call OnClose
- Element() js.Value
- RegisterKeyboardShortcut() - global Cmd+K / Ctrl+K listener
- UnregisterKeyboardShortcut()

**Keyboard handling (in input):**
- ArrowDown: highlight next
- ArrowUp: highlight previous
- Enter: execute highlighted command, close
- Escape: close

**Filtering:**
- Filter commands by Label and Description (case-insensitive contains)
- Group results by Category if categories exist
- Re-render on each input change

**Visual:**
- Highlighted item: bg-blue-50 dark:bg-blue-900/30
- Category headers: text-xs text-gray-500 uppercase px-4 py-2
- Command item: px-4 py-2, cursor-pointer, hover:bg-gray-100
- Show icon, label, description, shortcut hint
- Icon on left, shortcut hint on right (text-gray-400 text-xs)

Use FocusTrap to keep focus within palette while open.
Prevent body scroll while open (like Modal).
  </action>
  <verify>
Run `go build ./...` - no compile errors.
Component should compile and be importable.
  </verify>
  <done>
- CommandPalette component created in components/command_palette.go
- Props include Commands slice, placeholder, empty message
- Open/Close methods work
- Search input filters commands by label/description
- Keyboard navigation works (up/down/enter/esc)
- Results grouped by category
- Focus trapped within palette
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate CommandPalette with global Cmd+K and example app</name>
  <files>example/app/main.go</files>
  <action>
Integrate CommandPalette into the example application:

1. Create CommandPalette instance with sample commands:

Navigation commands:
- Dashboard (path: /)
- API Test (path: /api-test)
- Create Post (path: /create-post)
- Components (path: /components)
- Settings (path: /settings)

Action commands:
- Toggle Sidebar (category: Actions, shortcut: Ctrl+B)
- Toggle Dark Mode (category: Actions)
- Refresh Page (category: Actions)
- Clear Notifications (category: Actions)

2. Wire up OnExecute callbacks:
- Navigation: router.Navigate(path)
- Toggle Sidebar: layout.Sidebar().ToggleCollapse()
- Toggle Dark Mode: call theme toggle
- Refresh: js.Global().Get("location").Call("reload")
- Clear Notifications: show toast

3. Mount palette element to DOM (append to body or app root)

4. Register global keyboard shortcut after creating palette:
   - Call palette.RegisterKeyboardShortcut()
   - This enables Cmd+K / Ctrl+K to open palette

5. Close palette after command execution (palette should auto-close)

Note: Commands should be defined as a slice variable for easy extension later.
  </action>
  <verify>
Run app, press Cmd+K (Mac) or Ctrl+K (Windows/Linux) - palette opens.
Type to filter commands, use arrows to navigate, Enter to execute.
  </verify>
  <done>
- CommandPalette integrated into example app
- 9+ commands available (5 navigation + 4+ actions)
- Cmd+K / Ctrl+K opens palette globally
- Selecting navigation command navigates to page
- Selecting action command executes action
- Palette closes after command execution
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Command Palette with Cmd+K trigger and sample navigation/action commands</what-built>
  <how-to-verify>
    1. Run: `cd example && make run`
    2. Visit: http://localhost:8080
    3. Open palette:
       - Press Cmd+K (Mac) or Ctrl+K (Windows/Linux)
       - Palette overlay should appear centered near top
       - Search input should be focused
    4. Search/Filter:
       - Type "set" - should filter to Settings
       - Type "dash" - should filter to Dashboard
       - Clear input - all commands visible
    5. Keyboard navigation:
       - Press ArrowDown - highlight moves down
       - Press ArrowUp - highlight moves up
       - Press Enter - selected command executes
       - Press Escape - palette closes
    6. Execute commands:
       - Select "Dashboard" - navigates to /
       - Select "Toggle Sidebar" - sidebar collapses/expands
       - Select "Settings" - navigates to /settings
    7. Visual checks:
       - Commands grouped by category (Navigation, Actions)
       - Keyboard shortcut hints visible (Ctrl+B for Toggle Sidebar)
       - Highlighted item visually distinct
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` succeeds from project root
- [ ] Cmd+K / Ctrl+K opens command palette
- [ ] Search filters commands correctly
- [ ] Keyboard navigation works (up/down/enter/esc)
- [ ] Executing command navigates or performs action
- [ ] Palette closes after command execution
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Command palette opens with Cmd+K globally
- Commands filterable by search
- Full keyboard navigation support
- Navigation and action commands work correctly
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-layout-navigation/02-02-SUMMARY.md` following the summary template.

Include in summary: "Phase 2 complete, ready for Phase 3"
</output>
