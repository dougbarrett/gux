---
phase: 09-keyboard-navigation
plan: 04
type: execute
---

<objective>
Implement focus management polish for Dropdown, Sidebar, and add Skip Link component.

Purpose: Complete keyboard accessibility by restoring focus on Dropdown close, managing Sidebar mobile focus, and providing skip navigation for keyboard users (WCAG 2.4.1, 2.4.3).
Output: Polished focus management across navigation components plus a reusable SkipLink component.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 8 established ARIA patterns:
@.planning/phases/08-aria-semantic-markup/08-05-SUMMARY.md

# Existing keyboard patterns:
@.planning/phases/04-ux-polish/04-02-SUMMARY.md

# Components to modify:
@components/dropdown.go
@components/sidebar.go

**Tech stack available:** Go/WASM, syscall/js
**Established patterns:**
- Dropdown has keyboard navigation, missing focus restoration
- Sidebar has mobile toggle, missing focus management
- Modal focus restoration pattern (from 09-01)

**Constraining decisions:**
- Phase 08-05: Dropdown trigger stores reference for ARIA updates
- Phase 08-05: Sidebar has role="navigation" with aria-label

**Issues being addressed:**
- Dropdown focus restoration to trigger on close
- Sidebar mobile focus management on open/close
- P3: Skip link support for bypass blocks (WCAG 2.4.1)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add focus restoration to Dropdown</name>
  <files>components/dropdown.go</files>
  <action>
Restore focus to trigger element when Dropdown closes:

1. In Close() method, after updating ARIA states and before returning:
   ```
   // Restore focus to trigger
   if !d.trigger.IsUndefined() && !d.trigger.IsNull() {
       d.trigger.Call("focus")
   }
   ```

2. Ensure this happens for all close paths:
   - Escape key (already in keyHandler)
   - Click outside (clickOutside handler)
   - Selecting an item (item click handler - optional, depends on UX)

3. For item selection, focus should return to trigger after the item's OnClick executes

This follows the Modal focus restoration pattern established in 09-01.
  </action>
  <verify>
Manual test: Open dropdown via click, press Escape - focus returns to trigger button.
Click outside dropdown - focus returns to trigger.
Select an item - focus returns to trigger.
  </verify>
  <done>Focus returns to Dropdown trigger after closing via any method</done>
</task>

<task type="auto">
  <name>Task 2: Add mobile focus management to Sidebar</name>
  <files>components/sidebar.go</files>
  <action>
Manage focus when mobile sidebar opens and closes:

1. Add `lastFocusedElement js.Value` field to Sidebar struct

2. In Open() (mobile toggle):
   - Store document.activeElement as lastFocusedElement
   - After sidebar becomes visible, focus the close button or first nav item:
     ```
     closeBtn.Call("focus")
     ```

3. In Close():
   - Restore focus to lastFocusedElement if valid
   - Clear lastFocusedElement

4. Consider adding focus trap for mobile sidebar (optional - it's a drawer, not a dialog)
   - Mobile sidebar overlays content like a modal
   - If implementing, follow the Modal focus trap pattern from 09-01

Note: Desktop sidebar is always visible (static position), so focus management only applies to mobile.
  </action>
  <verify>
Manual test (mobile viewport): Click hamburger to open sidebar, verify close button receives focus.
Close sidebar, verify focus returns to hamburger button.
Tab navigation stays within sidebar when open (if focus trap added).
  </verify>
  <done>Mobile sidebar focuses close button on open and restores focus on close</done>
</task>

<task type="auto">
  <name>Task 3: Create SkipLink component</name>
  <files>components/skip_link.go</files>
  <action>
Create a new SkipLink component for keyboard navigation bypass (WCAG 2.4.1):

1. Create components/skip_link.go with build tag `//go:build js && wasm`

2. Define SkipLinkProps:
   ```go
   type SkipLinkProps struct {
       TargetID string // ID of the main content to skip to
       Label    string // Link text (default "Skip to main content")
   }
   ```

3. Create SkipLink function:
   ```go
   func SkipLink(props SkipLinkProps) js.Value {
       document := js.Global().Get("document")

       link := document.Call("createElement", "a")
       link.Set("href", "#" + props.TargetID)

       label := props.Label
       if label == "" {
           label = "Skip to main content"
       }
       link.Set("textContent", label)

       // Visually hidden until focused, then visible
       link.Set("className", "sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:bg-white focus:px-4 focus:py-2 focus:rounded focus:shadow-lg focus:text-blue-600 focus:underline focus:outline-none focus:ring-2 focus:ring-blue-500")

       return link
   }
   ```

4. Usage: Add SkipLink as first focusable element in page layout, with TargetID pointing to main content container with matching id attribute.

The skip link is visually hidden but appears when focused via Tab, allowing keyboard users to bypass navigation.
  </action>
  <verify>
Build succeeds: `go build ./...`
Component can be imported and used in example app.
Tabbing to skip link reveals it visually.
Activating skip link moves focus to target element.
  </verify>
  <done>SkipLink component created, visually hidden until focused, skips to target on activation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Dropdown: Escape closes and returns focus to trigger
- [ ] Dropdown: Click outside returns focus to trigger
- [ ] Dropdown: Item selection returns focus to trigger
- [ ] Sidebar (mobile): Opens with focus on close button
- [ ] Sidebar (mobile): Closes with focus returned to opener
- [ ] SkipLink: Renders as visually hidden link
- [ ] SkipLink: Becomes visible when focused
- [ ] SkipLink: Clicking moves focus to target
- [ ] `go build ./...` succeeds
- [ ] No console errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Focus management consistent across components
- SkipLink provides bypass mechanism per WCAG 2.4.1
- Phase 9 complete with all keyboard gaps addressed
</success_criteria>

<output>
After completion, create `.planning/phases/09-keyboard-navigation/09-04-SUMMARY.md`
</output>
