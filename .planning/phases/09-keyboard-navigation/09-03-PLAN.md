---
phase: 09-keyboard-navigation
plan: 03
type: execute
---

<objective>
Implement arrow key navigation for DatePicker calendar grid.

Purpose: Enable keyboard users to navigate the calendar grid using arrow keys per WAI-ARIA Grid pattern (WCAG 2.1.1). This is a P0 Critical accessibility gap.
Output: DatePicker with full keyboard navigation in calendar: arrows, Enter to select, Escape to close.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 8 established ARIA patterns for DatePicker:
@.planning/phases/08-aria-semantic-markup/08-06-SUMMARY.md

# Component to modify:
@components/datepicker.go

# Reference for keyboard handling:
@components/dropdown.go (keyHandler pattern)
@components/command_palette.go (complex keyboard handling)

**Tech stack available:** Go/WASM, syscall/js, time package
**Established patterns:**
- role="grid" with role="gridcell" on calendar days
- aria-selected on selected date
- aria-live on month/year display

**Constraining decisions:**
- Phase 08-06: DatePicker uses semantic table with role="grid"
- Calendar organized as weeks (rows of 7 days)

**Issues being addressed:**
- P0 #4: DatePicker no keyboard navigation in calendar
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add arrow key grid navigation to DatePicker</name>
  <files>components/datepicker.go</files>
  <action>
Implement grid-based arrow key navigation for calendar:

1. Add fields to DatePicker struct:
   - `focusedDay int` - currently focused day (1-31)
   - `keyHandler js.Func` - for cleanup
   - `dayButtons []js.Value` - store day button references for focus management

2. In renderCalendar(), store day button references in dayButtons slice (indexed by day-1)

3. In open(), set up keydown handler on the calendar element:

   ```
   switch key {
   case "ArrowRight":
       event.Call("preventDefault")
       // Move to next day, skip to next month if at end
       dp.moveFocusBy(1)
   case "ArrowLeft":
       event.Call("preventDefault")
       // Move to previous day, skip to prev month if at start
       dp.moveFocusBy(-1)
   case "ArrowDown":
       event.Call("preventDefault")
       // Move down one week (7 days)
       dp.moveFocusBy(7)
   case "ArrowUp":
       event.Call("preventDefault")
       // Move up one week (-7 days)
       dp.moveFocusBy(-7)
   }
   ```

4. Add helper method moveFocusBy(days int):
   - Calculate new date: displayed date + days
   - If new date is in different month, update displayed month and re-render
   - Set focusedDay to new day
   - Focus the day button: dayButtons[focusedDay-1].Call("focus")

5. When calendar opens, set focusedDay to selected day (or today, or 1) and focus it

6. Add tabindex="0" to focused day button, tabindex="-1" to others (roving tabindex)
  </action>
  <verify>
Manual test: Open DatePicker, verify a day is focused.
Right arrow moves to next day. Left moves to previous.
Down arrow moves down one week. Up arrow moves up one week.
Navigation at month boundary changes the month.
  </verify>
  <done>Arrow keys navigate calendar grid: Left/Right by day, Up/Down by week, with month boundary handling</done>
</task>

<task type="auto">
  <name>Task 2: Add Enter to select and Escape to close</name>
  <files>components/datepicker.go</files>
  <action>
Complete keyboard interaction with Enter and Escape:

1. Extend the keydown handler switch statement:

   ```
   case "Enter", " ":
       event.Call("preventDefault")
       // Select the focused date
       focusedDate := time.Date(dp.displayed.Year(), dp.displayed.Month(), dp.focusedDay, 0, 0, 0, 0, time.Local)
       // Check if disabled before selecting
       if !dp.isDateDisabled(focusedDate) {
           dp.selectDate(focusedDate)
       }
   case "Escape":
       event.Call("preventDefault")
       dp.close()
       dp.input.Call("focus") // Return focus to input
   ```

2. Add helper method isDateDisabled(date time.Time) bool:
   - Check against MinDate and MaxDate props
   - Return true if date is outside allowed range

3. In close():
   - Remove keydown event listener
   - Call keyHandler.Release()
   - Clean up dayButtons slice

4. Ensure focus restoration to input on Escape (already handled above)
  </action>
  <verify>
Manual test: Navigate to a date with arrow keys, press Enter - date is selected and calendar closes.
Press Escape - calendar closes without selecting, focus returns to input.
Space bar also selects the focused date.
Disabled dates cannot be selected with Enter.
  </verify>
  <done>Enter/Space selects focused date, Escape closes calendar with focus restoration to input</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Arrow Right moves to next day
- [ ] Arrow Left moves to previous day
- [ ] Arrow Down moves down one week
- [ ] Arrow Up moves up one week
- [ ] Navigation crosses month boundaries correctly
- [ ] Enter key selects focused date
- [ ] Space key selects focused date
- [ ] Escape closes calendar without selection
- [ ] Focus returns to input after closing
- [ ] Disabled dates cannot be selected via keyboard
- [ ] Calendar opens with a day focused
- [ ] `go build ./...` succeeds
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- DatePicker keyboard navigation meets WAI-ARIA Grid pattern
- Complete keyboard operability without mouse
</success_criteria>

<output>
After completion, create `.planning/phases/09-keyboard-navigation/09-03-SUMMARY.md`
</output>
