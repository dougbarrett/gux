---
phase: 04-ux-polish
plan: 02
type: execute
---

<objective>
Add keyboard navigation to Dropdown component for accessibility.

Purpose: Users should be able to navigate dropdown menus with keyboard (arrow keys, enter, escape).
Output: Dropdown component with full keyboard navigation support.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-layout-navigation/02-02-SUMMARY.md

# Key files:
@components/dropdown.go
@components/command_palette.go  # Reference for keyboard navigation pattern

**Tech available:** syscall/js for DOM manipulation
**Established patterns:**
- CommandPalette has ArrowUp/Down, Enter, Escape handling
- CommandPalette tracks highlightIdx and uses updateHighlightStyles()
- CommandPalette uses data-index attribute for style updates

**Constraining decisions:**
- Phase 02-02: Use updateHighlightStyles() approach for hover to preserve click handlers
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard navigation to Dropdown</name>
  <files>components/dropdown.go</files>
  <action>
Add keyboard navigation following CommandPalette pattern:

1. Add fields to Dropdown struct:
   - highlightIdx int
   - menuItems []js.Value (to track menu item elements, excluding dividers)
   - keyHandler js.Func

2. In NewDropdown(), collect non-divider menu items into menuItems slice during creation.

3. Add keydown handler that activates when dropdown is open:
   - ArrowDown: Increment highlightIdx (wrap to 0)
   - ArrowUp: Decrement highlightIdx (wrap to last)
   - Enter: Execute highlighted item's onClick and close
   - Escape: Close dropdown
   - Call event.preventDefault() for these keys

4. Add updateHighlightStyles() method:
   - Iterate menuItems, apply highlight class to current highlightIdx
   - Use "bg-gray-100 dark:bg-gray-700" for highlighted state

5. Add mouseenter handler to each menu item to sync highlightIdx on hover.

6. In Open():
   - Reset highlightIdx to 0
   - Register keydown handler on document
   - Focus the menu container for keyboard events

7. In Close():
   - Remove keydown handler from document

8. Update Destroy() to clean up keyHandler.

Reference CommandPalette lines 119-136 for keydown pattern and 264-279 for updateHighlightStyles.
  </action>
  <verify>
1. Build: `cd example && make build`
2. Run: `cd example && make run`
3. Open dropdown (Actions menu in Advanced tab)
4. Press ArrowDown - highlight moves down
5. Press ArrowUp - highlight moves up
6. Press Enter - executes item
7. Press Escape - closes dropdown
  </verify>
  <done>
- Arrow keys navigate dropdown items
- Enter selects highlighted item
- Escape closes dropdown
- Visual highlight follows keyboard and mouse
  </done>
</task>

<task type="auto">
  <name>Task 2: Add focus management for accessibility</name>
  <files>components/dropdown.go</files>
  <action>
Improve focus management for better accessibility:

1. Add tabindex="0" to menu container to make it focusable.

2. When Open() is called, focus the menu element:
   - d.menu.Call("focus") after removing "hidden" class

3. On blur (when focus leaves dropdown), close it:
   - Add focusout event listener
   - Check if relatedTarget is inside dropdown, if not, close

4. Add aria attributes:
   - Menu: role="menu", aria-orientation="vertical"
   - Items: role="menuitem"
   - Add aria-activedescendant pointing to highlighted item id

This makes the dropdown keyboard-accessible and screen-reader friendly.
  </action>
  <verify>
1. Build: `cd example && make build`
2. Tab to trigger element, Enter to open dropdown
3. Arrow keys work in opened dropdown
4. Tab away from dropdown closes it
5. Check accessibility: menu has role="menu", items have role="menuitem"
  </verify>
  <done>
- Dropdown is focusable with Tab
- Focus moves to menu when opened
- Blur closes dropdown
- ARIA attributes present
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd example && make build` succeeds
- [ ] Keyboard navigation works (arrows, enter, escape)
- [ ] Focus management works
- [ ] Existing click behavior still works
</verification>

<success_criteria>
- All tasks completed
- Dropdown has full keyboard navigation
- Accessible with Tab and arrow keys
- No regressions in existing dropdown functionality
</success_criteria>

<output>
After completion, create `.planning/phases/04-ux-polish/04-02-SUMMARY.md`
</output>
