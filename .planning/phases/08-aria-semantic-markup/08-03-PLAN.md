---
phase: 08-aria-semantic-markup
plan: 03
type: execute
domain: go-wasm
---

<objective>
Add proper label associations and error linking to form control components.

Purpose: Enable screen reader users to understand form field purposes and error states.
Output: Form controls with programmatic label-input association and error message linking.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-accessibility-audit/A11Y-AUDIT.md

# Source files to modify:
@components/input.go
@components/select.go
@components/textarea.go
@components/checkbox.go
@components/form.go
@components/formbuilder.go

**From Phase 7 Audit - Form Control Issues:**
- Input: Label not associated via for/id, missing aria-invalid on error
- Select: Label not associated
- TextArea: Label not associated
- Checkbox: Label not associated via htmlFor
- Form/FormBuilder: Error messages not linked via aria-describedby

**WAI-ARIA Patterns:**
- Label association: label[for] matches input[id]
- Error state: aria-invalid="true" when field has error
- Error description: aria-describedby pointing to error message element
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add label-input association to Input, Select, and TextArea</name>
  <files>components/input.go, components/select.go, components/textarea.go</files>
  <action>
**Input component (input.go):**
1. Generate unique ID for input: `input-{uuid}` using crypto.randomUUID()
2. Set `id={input-id}` on the input element
3. If label exists, set `for={input-id}` on the label element (use "htmlFor" attribute name)
4. Add aria-invalid support:
   - Add `errorId` field to Input struct
   - Update SetError() to:
     - Generate error ID: `input-error-{uuid}`
     - Set `aria-invalid="true"` on input
     - Set `aria-describedby={error-id}` on input
     - Create/update error message element with `id={error-id}`
   - Update ClearError() to:
     - Remove `aria-invalid` attribute
     - Remove `aria-describedby` attribute
     - Remove error message element

**Select component (select.go):**
1. Generate unique ID for select: `select-{uuid}`
2. Set `id={select-id}` on the select element
3. If label exists, set `for={select-id}` on the label element

**TextArea component (textarea.go):**
1. Generate unique ID for textarea: `textarea-{uuid}`
2. Set `id={textarea-id}` on the textarea element
3. If label exists, set `for={textarea-id}` on the label element

Pattern: Programmatic label association allows AT to announce label when field is focused.
  </action>
  <verify>Build passes: `cd example && make build` succeeds without errors</verify>
  <done>Input/Select/TextArea have for/id label association, Input supports aria-invalid and aria-describedby for errors</done>
</task>

<task type="auto">
  <name>Task 2: Add label association to Checkbox</name>
  <files>components/checkbox.go</files>
  <action>
Update Checkbox component:
1. Generate unique ID for checkbox input: `checkbox-{uuid}`
2. Set `id={checkbox-id}` on the input[type="checkbox"] element
3. Set `for={checkbox-id}` on the label element (htmlFor attribute)
4. Ensure the label wraps or is adjacent to the checkbox for click handling
5. If there's a description/helper text, add:
   - Generate description ID: `checkbox-desc-{uuid}`
   - Set `aria-describedby={desc-id}` on input
   - Set `id={desc-id}` on description element

Current pattern check: Checkbox likely has label as sibling or wrapper. Ensure for/id association regardless of DOM structure.
  </action>
  <verify>Build passes: `cd example && make build` succeeds without errors</verify>
  <done>Checkbox has for/id label association, description linked via aria-describedby if present</done>
</task>

<task type="auto">
  <name>Task 3: Add aria-describedby for error messages in Form and FormBuilder</name>
  <files>components/form.go, components/formbuilder.go</files>
  <action>
**Form component (form.go):**
1. When rendering field errors:
   - Generate error ID: `form-error-{field}-{uuid}`
   - Set `id={error-id}` on error message element
   - Find corresponding input and add `aria-describedby={error-id}`
   - Add `aria-invalid="true"` to input with error
2. When clearing errors:
   - Remove aria-invalid and aria-describedby from affected inputs

**FormBuilder component (formbuilder.go):**
1. For each field with validation error:
   - Generate error ID: `fb-error-{field}-{uuid}`
   - Set `id={error-id}` on error message element
   - Set `aria-describedby={error-id}` on the field's input
   - Set `aria-invalid="true"` on the field's input
2. On field validation success:
   - Remove aria-invalid attribute
   - Remove aria-describedby reference to error (keep other descriptions)
3. Ensure field descriptions (helper text) are also linked via aria-describedby:
   - Multiple IDs can be space-separated: `aria-describedby="helper-id error-id"`

Pattern: Error messages must be programmatically associated with their fields.
  </action>
  <verify>Build passes: `cd example && make build` succeeds without errors</verify>
  <done>Form and FormBuilder link error messages to inputs via aria-describedby, inputs have aria-invalid on error</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd example && make build` succeeds without errors
- [ ] Input/Select/TextArea labels have for attribute matching input id
- [ ] Checkbox label has for attribute matching checkbox id
- [ ] Form error messages have id and are linked via aria-describedby
- [ ] FormBuilder error messages have id and are linked via aria-describedby
- [ ] Fields with errors have aria-invalid="true"
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No build errors
- Form fields announce their labels and error states to screen readers
</success_criteria>

<output>
After completion, create `.planning/phases/08-aria-semantic-markup/08-03-SUMMARY.md`
</output>
